var Point=function(){function d(a,c,b){void 0===b&&(b=-1);this.angle=0;this.x=a;this.y=c;this.i=b}d.prototype.getX=function(){return this.x};d.prototype.getY=function(){return this.y};d.prototype.getI=function(){return this.i};d.prototype.getAngle=function(){return this.angle};d.prototype.setAngle=function(a){this.angle=a;return this};return d}(),Canvas=function(){function d(a,c){this.canvas=a;this.padding=c;this.width=a.width();this.height=a.height()}d.prototype.getWidth=function(){return this.width};
d.prototype.getHeight=function(){return this.height};d.prototype.getPadding=function(){return this.padding};d.prototype.drawPoints=function(a){this.canvas.removeLayers().clearCanvas();for(var c=0,b=a.length;c<b;c++)this.drawPoint(""+c,a[c],"#000","#777")};d.prototype.drawPoint=function(a,c,b,e){this.canvas.drawArc({radius:3,layer:!0,x:c.getX(),y:c.getY(),strokeWidth:1,groups:["point"],fillStyle:e,name:"point."+a,strokeStyle:b})};d.prototype.highlightPoint=function(a,c,b){this.canvas.setLayer("point."+
a.getI(),{fillStyle:b,strokeStyle:c}).drawLayers()};d.prototype.drawPolygon=function(a,c,b){this.canvas.removeLayerGroup("polygon");for(var e=0,d=a.length;e<d;e++)this.highlightPoint(a[e],c,b),this.canvas.drawLine({layer:!0,strokeWidth:2,strokeStyle:b,groups:["polygon"],name:"polygonLine."+e,x1:a[e].getX(),y1:a[e].getY(),x2:a[(e+1)%d].getX(),y2:a[(e+1)%d].getY()})};d.prototype.operationCountInfo=function(a,c,b){this.canvas.drawText({x:10,y:428,layer:!0,fontSize:12,align:"left",fillStyle:"#777",fromCenter:!1,
name:"operationCount",text:a+" operations in "+c+"ms ("+b+")"})};d.prototype.clearSolution=function(){this.canvas.removeLayerGroup("polygon").removeLayer("operationCount").setLayerGroup("point",{fillStyle:"#777",strokeStyle:"#000"}).drawLayers()};return d}(),Controls=function(){function d(){}d.prototype.getPointCount=function(){return parseInt(this.pointCountSlider.val())};return d}(),Result=function(){function d(){this.counter=0;this.polygon=[]}d.prototype.count=function(a){void 0===a&&(a=1);this.counter+=
a};d.prototype.getCounter=function(){return this.counter};d.prototype.addVertex=function(a){this.polygon.push(a);return this};d.prototype.getPolygon=function(){return this.polygon};d.prototype.sortPolygon=function(){this.polygon=Helpers.sortConvexPolygon(this.polygon);return this};return d}(),Helpers=function(){function d(){}d.sortConvexPolygon=function(a){for(var c=this.findCentroid(a),b=0,e=a.length;b<e;b++)a[b].setAngle(Math.atan2(a[b].getY()-c.getY(),a[b].getX()-c.getX()));a.sort(function(a,b){return a.getAngle()-
b.getAngle()});return a};d.findCentroid=function(a){for(var c=0,b=0,e=0,d=a.length;e<d;e++)c+=a[e].getX(),b+=a[e].getY();return new Point(c/d,b/d)};d.laysPointInTriangle=function(a,c,b,e){return 0>=(b.getY()-c.getY())*(c.getX()-a.getX())+(c.getX()-b.getX())*(c.getY()-a.getY())&&0>=(e.getY()-b.getY())*(b.getX()-a.getX())+(b.getX()-e.getX())*(b.getY()-a.getY())&&0>=(c.getY()-e.getY())*(e.getX()-a.getX())+(e.getX()-c.getX())*(e.getY()-a.getY())};d.findExtremes=function(a){for(var c=null,b=null,e=0,d=
a.length;e<d;e++){if(null===c||a[e].getX()<c.getX())c=a[e];if(null===b||a[e].getX()>b.getX())b=a[e]}return{min:c,max:b}};d.vectorsAngle=function(a,c){return Math.atan2(a[0]*c[1]-c[0]*a[1],a[0]*c[0]+a[1]*c[1])};d.findFarthestPointFromLineToTheLeft=function(a,c,b){for(var e=null,g=null,f=0,h=b.length;f<h;f++)if(b[f]!==a&&b[f]!==c&&d.isPointToTheLeftFromLine(b[f],a,c)){var k=d.pointFromLineDistance(b[f],a,c);if(null===g||k>g)e=b[f],g=k}return e};d.splitPointsByTriangle=function(a,c,b,e){for(var g=[[],
[]],f=0,h=e.length;f<h;f++)e[f]!==a&&e[f]!==c&&e[f]!==b&&(d.laysPointInTriangle(e[f],a,c,b)||(d.isPointToTheLeftFromLine(e[f],a,b)?g[0].push(e[f]):d.isPointToTheLeftFromLine(e[f],b,c)&&g[1].push(e[f])));return g};d.isPointToTheLeftFromLine=function(a,c,b){return 0>(b.getX()-c.getX())*(a.getY()-c.getY())-(b.getY()-c.getY())*(a.getX()-c.getX())};d.pointFromLineDistance=function(a,c,b){var e=b.getX()-c.getX(),d=b.getY()-c.getY();return Math.abs(d*a.getX()-e*a.getY()+b.getX()*c.getY())/Math.sqrt(e*e+
d*d)};return d}(),ConvexHull=function(){function d(){}d.quickHull=function(a){var c=new Result,b=Helpers.findExtremes(a),e=b.min,b=b.max;c.count(a.length);c.addVertex(e);c.addVertex(b);d._quickHull(e,b,a,c);d._quickHull(b,e,a,c);c.sortPolygon();return c};d._quickHull=function(a,c,b,e){if(b.length){var g=Helpers.findFarthestPointFromLineToTheLeft(a,c,b);e.addVertex(g);e.count(b.length);var f=Helpers.splitPointsByTriangle(a,c,g,b);e.count(b.length);d._quickHull(a,g,f[0],e);d._quickHull(g,c,f[1],e)}};
d.giftWrapping=function(a){var c=new Result,b=Helpers.findExtremes(a).max,e=b,d=[0,-1];do{c.count();c.addVertex(e);for(var f=null,h=null,k=null,l=0,p=a.length;l<p;l++)if(a[l]!==e){c.count();var m=[a[l].getX()-e.getX(),a[l].getY()-e.getY()],n=Helpers.vectorsAngle(d,m);if(null===f||n<f)f=n,h=m,k=a[l]}d=h;e=k}while(e!==b);return c};d.primitive=function(a){for(var c=new Result,b=a.length,e=0;e<b;e++){for(var d=!0,f=0;d&&f<b;f++)if(e!==f)for(var h=0;d&&h<b;h++)if(e!==h&&f!==h)for(var k=0;d&&k<b;k++)e!==
k&&f!==k&&h!==k&&(c.count(),Helpers.laysPointInTriangle(a[e],a[f],a[h],a[k])&&(d=!1));d&&c.addVertex(a[e])}c.sortPolygon();return c};return d}(),Program=function(){function d(a,c){this.points=[];this.canvas=a;this.controls=c}d.prototype.run=function(){var a=this;a.controls.pointCountInfo.text(a.controls.getPointCount());this.controls.pointCountSlider.on("input change",function(b){a.controls.pointCountInfo.text(a.controls.getPointCount())});for(var c=this.getAlgButtons(),b=0,d=c.length;b<d;b++)c[b].on("click",
function(b){a.setAlgButtonsDisabled(!0);a.controls.clearButton.attr("disabled",null)});this.controls.generatorButton.on("click",function(b){a.generatePoints(a.controls.getPointCount());a.canvas.drawPoints(a.points);a.setAlgButtonsDisabled(!1);a.controls.clearButton.attr("disabled",!0)});this.controls.quickHullButton.on("click",function(b){a.runAlgorithm(ConvexHull.quickHull,"quick hull")});this.controls.giftWrappingButton.on("click",function(b){a.runAlgorithm(ConvexHull.giftWrapping,"gift wrapping")});
this.controls.primitiveButton.on("click",function(b){a.runAlgorithm(ConvexHull.primitive,"primitive")});this.controls.clearButton.on("click",function(b){a.canvas.clearSolution();a.setAlgButtonsDisabled(!1);a.controls.clearButton.attr("disabled",!0)})};d.prototype.generatePoints=function(a){for(this.points=[];this.points.length<a;){for(var c=!1,b=this.canvas.getPadding()+Math.floor((this.canvas.getWidth()-2*this.canvas.getPadding())*Math.random()),d=this.canvas.getPadding()+Math.floor((this.canvas.getHeight()-
2*this.canvas.getPadding())*Math.random()),g=0,f=this.points.length;g<f;g++)if(this.points[g].getX()===b||this.points[g].getY()===d){c=!0;break}c||this.points.push(new Point(b,d,g))}};d.prototype.runAlgorithm=function(a,c){var b=(new Date).getTime(),d=a(this.points),b=(new Date).getTime()-b;this.canvas.drawPolygon(d.getPolygon(),"#44f","#99f");this.canvas.operationCountInfo(d.getCounter(),b,c)};d.prototype.setAlgButtonsDisabled=function(a){void 0===a&&(a=!0);for(var c=this.getAlgButtons(),b=0,d=c.length;b<
d;b++)c[b].attr("disabled",a?!0:null)};d.prototype.getAlgButtons=function(){return[this.controls.quickHullButton,this.controls.giftWrappingButton,this.controls.primitiveButton]};return d}();
(function(d,a){var c=new Canvas(a("#canvas"),50),b=new Controls;b.pointCountSlider=a("#point-count");b.pointCountInfo=a("#point-count-info");b.generatorButton=a("#generate");b.quickHullButton=a("#alg-quick-hull");b.giftWrappingButton=a("#alg-gift-wrapping");b.primitiveButton=a("#alg-primitive");b.clearButton=a("#clear");(new Program(c,b)).run()})(window,window.jQuery);
