var Point=function(){function d(a,b,c){void 0===c&&(c=-1);this.angle=0;this.x=a;this.y=b;this.i=c}d.prototype.getX=function(){return this.x};d.prototype.getY=function(){return this.y};d.prototype.getI=function(){return this.i};d.prototype.getAngle=function(){return this.angle};d.prototype.setAngle=function(a){this.angle=a;return this};return d}(),Canvas=function(){function d(a,b){this.canvas=a;this.padding=b;this.width=a.width();this.height=a.height()}d.prototype.getWidth=function(){return this.width};
d.prototype.getHeight=function(){return this.height};d.prototype.getPadding=function(){return this.padding};d.prototype.drawPoints=function(a){this.canvas.removeLayers().clearCanvas();for(var b=0,c=a.length;b<c;b++)this.drawPoint(""+b,a[b],"#000","#777")};d.prototype.drawPoint=function(a,b,c,e){this.canvas.drawArc({radius:3,layer:!0,x:b.getX(),y:b.getY(),strokeWidth:1,groups:["point"],fillStyle:e,name:"point."+a,strokeStyle:c})};d.prototype.highlightPoint=function(a,b,c){this.canvas.setLayer("point."+
a.getI(),{fillStyle:c,strokeStyle:b}).drawLayers()};d.prototype.drawPolygon=function(a,b,c){this.canvas.removeLayerGroup("polygon");for(var e=0,d=a.length;e<d;e++)this.highlightPoint(a[e],b,c),this.canvas.drawLine({layer:!0,strokeWidth:2,strokeStyle:c,groups:["polygon"],name:"polygonLine."+e,x1:a[e].getX(),y1:a[e].getY(),x2:a[(e+1)%d].getX(),y2:a[(e+1)%d].getY()})};d.prototype.operationCountInfo=function(a,b,c){this.canvas.drawText({x:10,y:428,layer:!0,fontSize:12,align:"left",fillStyle:"#777",fromCenter:!1,
name:"operationCount",text:a+" operations in "+b+"ms ("+c+")"})};d.prototype.clearSolution=function(){this.canvas.removeLayerGroup("polygon").removeLayer("operationCount").setLayerGroup("point",{fillStyle:"#777",strokeStyle:"#000"}).drawLayers()};return d}(),Controls=function(){function d(){}d.prototype.getPointCount=function(){return parseInt(this.pointCountSlider.val())};return d}(),Result=function(){function d(){this.counter=0;this.polygon=[]}d.prototype.count=function(a){void 0===a&&(a=1);this.counter+=
a};d.prototype.getCounter=function(){return this.counter};d.prototype.addVertex=function(a){this.polygon.push(a);return this};d.prototype.getPolygon=function(){return this.polygon};d.prototype.sortPolygon=function(){this.polygon=Helpers.sortConvexPolygon(this.polygon);return this};return d}(),Helpers=function(){function d(){}d.sortConvexPolygon=function(a){for(var b=this.findCentroid(a),c=0,e=a.length;c<e;c++)a[c].setAngle(Math.atan2(a[c].getY()-b.getY(),a[c].getX()-b.getX()));a.sort(function(a,b){return a.getAngle()-
b.getAngle()});return a};d.findCentroid=function(a){for(var b=0,c=0,e=0,d=a.length;e<d;e++)b+=a[e].getX(),c+=a[e].getY();return new Point(b/d,c/d)};d.laysPointInTriangle=function(a,b,c,e){return 0>=(c.getY()-b.getY())*(b.getX()-a.getX())+(b.getX()-c.getX())*(b.getY()-a.getY())&&0>=(e.getY()-c.getY())*(c.getX()-a.getX())+(c.getX()-e.getX())*(c.getY()-a.getY())&&0>=(b.getY()-e.getY())*(e.getX()-a.getX())+(e.getX()-b.getX())*(e.getY()-a.getY())};d.findExtremes=function(a){for(var b=null,c=null,e=0,d=
a.length;e<d;e++){if(null===b||a[e].getX()<b.getX())b=a[e];if(null===c||a[e].getX()>c.getX())c=a[e]}return{min:b,max:c}};d.vectorsAngle=function(a,b){return Math.atan2(a[0]*b[1]-b[0]*a[1],a[0]*b[0]+a[1]*b[1])};d.findFarthestPointFromLineToTheLeft=function(a,b,c){for(var e=null,g=null,f=0,h=c.length;f<h;f++)if(c[f]!==a&&c[f]!==b&&d.isPointToTheLeftFromLine(c[f],a,b)){var k=d.pointFromLineDistance(c[f],a,b);if(null===g||k>g)e=c[f],g=k}return e};d.splitPointsByTriangle=function(a,b,c,e){for(var g=[[],
[]],f=0,h=e.length;f<h;f++)e[f]!==a&&e[f]!==b&&e[f]!==c&&(d.laysPointInTriangle(e[f],a,b,c)||(d.isPointToTheLeftFromLine(e[f],a,c)?g[0].push(e[f]):d.isPointToTheLeftFromLine(e[f],c,b)&&g[1].push(e[f])));return g};d.isPointToTheLeftFromLine=function(a,b,c){return 0>(c.getX()-b.getX())*(a.getY()-b.getY())-(c.getY()-b.getY())*(a.getX()-b.getX())};d.pointFromLineDistance=function(a,b,c){var e=c.getX()-b.getX(),d=c.getY()-b.getY();return Math.abs(d*a.getX()-e*a.getY()+c.getX()*b.getY())/Math.sqrt(e*e+
d*d)};return d}(),ConvexHull=function(){function d(){}d.quickHull=function(a){var b=new Result,c=Helpers.findExtremes(a),e=c.min,c=c.max;b.count(a.length);b.addVertex(e);b.addVertex(c);d._quickHull(e,c,a,b);d._quickHull(c,e,a,b);b.sortPolygon();return b};d._quickHull=function(a,b,c,e){if(c.length){var g=Helpers.findFarthestPointFromLineToTheLeft(a,b,c);e.addVertex(g);e.count(c.length);var f=Helpers.splitPointsByTriangle(a,b,g,c);e.count(c.length);d._quickHull(a,g,f[0],e);d._quickHull(g,b,f[1],e)}};
d.giftWrapping=function(a){var b=new Result,c=Helpers.findExtremes(a).max,e=c,d=[0,-1];do{b.count();b.addVertex(e);for(var f=null,h=null,k=null,l=0,p=a.length;l<p;l++)if(a[l]!==e){b.count();var m=[a[l].getX()-e.getX(),a[l].getY()-e.getY()],n=Helpers.vectorsAngle(d,m);if(null===f||n<f)f=n,h=m,k=a[l]}d=h;e=k}while(e!==c);return b};d.primitive=function(a){for(var b=new Result,c=a.length,e=0;e<c;e++){for(var d=!0,f=0;d&&f<c;f++)if(e!==f)for(var h=0;d&&h<c;h++)if(e!==h&&f!==h)for(var k=0;d&&k<c;k++)e!==
k&&f!==k&&h!==k&&(b.count(),Helpers.laysPointInTriangle(a[e],a[f],a[h],a[k])&&(d=!1));d&&b.addVertex(a[e])}b.sortPolygon();return b};return d}(),Program=function(){function d(a,b){this.points=[];this.canvas=a;this.controls=b}d.prototype.run=function(){var a=this;a.controls.pointCountInfo.text(a.controls.getPointCount());this.controls.pointCountSlider.on("input change",function(b){a.controls.pointCountInfo.text(a.controls.getPointCount())});this.processAlgButtons(function(b){b.on("click",function(b){a.setAlgButtonsDisabled(!0);
a.controls.clearButton.attr("disabled",null)})});this.controls.generatorButton.on("click",function(b){a.generatePoints(a.controls.getPointCount());a.canvas.drawPoints(a.points);a.setAlgButtonsDisabled(!1);a.controls.clearButton.attr("disabled",!0)});this.controls.quickHullButton.on("click",function(b){a.runAlgorithm(ConvexHull.quickHull,"quick hull")});this.controls.giftWrappingButton.on("click",function(b){a.runAlgorithm(ConvexHull.giftWrapping,"gift wrapping")});this.controls.primitiveButton.on("click",
function(b){a.runAlgorithm(ConvexHull.primitive,"primitive")});this.controls.clearButton.on("click",function(b){a.canvas.clearSolution();a.setAlgButtonsDisabled(!1);a.controls.clearButton.attr("disabled",!0)})};d.prototype.generatePoints=function(a){for(this.points=[];this.points.length<a;){for(var b=!1,c=this.canvas.getPadding()+Math.floor((this.canvas.getWidth()-2*this.canvas.getPadding())*Math.random()),d=this.canvas.getPadding()+Math.floor((this.canvas.getHeight()-2*this.canvas.getPadding())*
Math.random()),g=0,f=this.points.length;g<f;g++)if(this.points[g].getX()===c||this.points[g].getY()===d){b=!0;break}b||this.points.push(new Point(c,d,g))}};d.prototype.runAlgorithm=function(a,b){var c=(new Date).getTime(),d=a(this.points),c=(new Date).getTime()-c;this.canvas.drawPolygon(d.getPolygon(),"#44f","#99f");this.canvas.operationCountInfo(d.getCounter(),c,b)};d.prototype.setAlgButtonsDisabled=function(a){void 0===a&&(a=!0);this.processAlgButtons(function(b){b.attr("disabled",a?!0:null)})};
d.prototype.processAlgButtons=function(a){for(var b=[this.controls.quickHullButton,this.controls.giftWrappingButton,this.controls.primitiveButton],c=0,d=b.length;c<d;c++)a(b[c])};return d}();
(function(d,a){var b=new Canvas(a("#canvas"),50),c=new Controls;c.pointCountSlider=a("#point-count");c.pointCountInfo=a("#point-count-info");c.generatorButton=a("#generate");c.quickHullButton=a("#alg-quick-hull");c.giftWrappingButton=a("#alg-gift-wrapping");c.primitiveButton=a("#alg-primitive");c.clearButton=a("#clear");(new Program(b,c)).run()})(window,window.jQuery);
