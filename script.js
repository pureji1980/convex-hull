var ConvexHull;(function(h){var f=function(){function b(a,c,d){void 0===d&&(d=-1);this.angle=0;this.x=a;this.y=c;this.i=d}b.prototype.getX=function(){return this.x};b.prototype.getY=function(){return this.y};b.prototype.getI=function(){return this.i};b.prototype.getAngle=function(){return this.angle};b.prototype.setAngle=function(a){this.angle=a;return this};return b}();h.Point=f})(ConvexHull||(ConvexHull={}));
(function(h){var f=function(){function b(a,c){this.canvas=a;this.padding=c;this.width=a.width();this.height=a.height()}b.prototype.getWidth=function(){return this.width};b.prototype.getHeight=function(){return this.height};b.prototype.getPadding=function(){return this.padding};b.prototype.drawPoints=function(a){this.canvas.removeLayers().clearCanvas();for(var c=0,d=a.length;c<d;c++)this.drawPoint(""+c,a[c],"#000","#777")};b.prototype.drawPoint=function(a,c,d,e){this.canvas.drawArc({radius:3,layer:!0,
x:c.getX(),y:c.getY(),strokeWidth:1,groups:["point"],fillStyle:e,name:"point."+a,strokeStyle:d})};b.prototype.highlightPoint=function(a,c,d){this.canvas.setLayer("point."+a.getI(),{fillStyle:d,strokeStyle:c}).drawLayers()};b.prototype.drawPolygon=function(a,c,d){this.canvas.removeLayerGroup("polygon");for(var e=0,b=a.length;e<b;e++)this.highlightPoint(a[e],c,d),this.canvas.drawLine({layer:!0,strokeWidth:2,strokeStyle:d,groups:["polygon"],name:"polygonLine."+e,x1:a[e].getX(),y1:a[e].getY(),x2:a[(e+
1)%b].getX(),y2:a[(e+1)%b].getY()})};b.prototype.operationCountInfo=function(a,c,d){this.canvas.drawText({x:10,y:428,layer:!0,fontSize:12,align:"left",fillStyle:"#777",fromCenter:!1,name:"operationCount",text:a+" operations in "+c+"ms ("+d+")"})};b.prototype.clearSolution=function(){this.canvas.removeLayerGroup("polygon").removeLayer("operationCount").setLayerGroup("point",{fillStyle:"#777",strokeStyle:"#000"}).drawLayers()};return b}();h.Canvas=f})(ConvexHull||(ConvexHull={}));
(function(h){var f=function(){function b(){this.counter=0;this.polygon=[]}b.prototype.count=function(a){void 0===a&&(a=1);this.counter+=a;return this};b.prototype.getCounter=function(){return this.counter};b.prototype.addVertex=function(a){this.polygon.push(a);return this};b.prototype.getPolygon=function(){return this.polygon};b.prototype.sortPolygon=function(){this.polygon=h.Helpers.sortConvexPolygon(this.polygon);return this};return b}();h.Result=f})(ConvexHull||(ConvexHull={}));
(function(h){var f=function(){function b(){}b.sortConvexPolygon=function(a){for(var c=this.findCentroid(a),d=0,e=a.length;d<e;d++)a[d].setAngle(Math.atan2(a[d].getY()-c.getY(),a[d].getX()-c.getX()));a.sort(function(a,c){return a.getAngle()-c.getAngle()});return a};b.findCentroid=function(a){for(var c=0,d=0,e=0,b=a.length;e<b;e++)c+=a[e].getX(),d+=a[e].getY();return new h.Point(c/b,d/b)};b.laysPointInTriangle=function(a,c,d,e){return 0>=(d.getY()-c.getY())*(c.getX()-a.getX())+(c.getX()-d.getX())*(c.getY()-
a.getY())&&0>=(e.getY()-d.getY())*(d.getX()-a.getX())+(d.getX()-e.getX())*(d.getY()-a.getY())&&0>=(c.getY()-e.getY())*(e.getX()-a.getX())+(e.getX()-c.getX())*(e.getY()-a.getY())};b.findExtremes=function(a){for(var c=null,d=null,e=0,b=a.length;e<b;e++){if(null===c||a[e].getX()<c.getX())c=a[e];if(null===d||a[e].getX()>d.getX())d=a[e]}return{min:c,max:d}};b.vectorsAngle=function(a,c){return Math.atan2(a[0]*c[1]-c[0]*a[1],a[0]*c[0]+a[1]*c[1])};b.findFarthestPointFromLineToTheLeft=function(a,c,d){for(var e=
null,k=null,g=0,h=d.length;g<h;g++)if(d[g]!==a&&d[g]!==c&&b.isPointToTheLeftFromLine(d[g],a,c)){var f=b.pointFromLineDistance(d[g],a,c);if(null===k||f>k)e=d[g],k=f}return e};b.splitPointsByTriangle=function(a,c,d,e){for(var k=[[],[]],g=0,h=e.length;g<h;g++)e[g]!==a&&e[g]!==c&&e[g]!==d&&(b.laysPointInTriangle(e[g],a,c,d)||(b.isPointToTheLeftFromLine(e[g],a,d)?k[0].push(e[g]):b.isPointToTheLeftFromLine(e[g],d,c)&&k[1].push(e[g])));return k};b.isPointToTheLeftFromLine=function(a,c,d){return 0>(d.getX()-
c.getX())*(a.getY()-c.getY())-(d.getY()-c.getY())*(a.getX()-c.getX())};b.pointFromLineDistance=function(a,c,d){var e=d.getX()-c.getX(),b=d.getY()-c.getY();return Math.abs(b*a.getX()-e*a.getY()+d.getX()*c.getY())/Math.sqrt(e*e+b*b)};return b}();h.Helpers=f})(ConvexHull||(ConvexHull={}));
(function(h){var f=function(){function b(){}b.quickHull=function(a){var c=new h.Result,d=h.Helpers.findExtremes(a),e=d.min,d=d.max;c.count(a.length);c.addVertex(e);c.addVertex(d);b._quickHull(e,d,a,c);b._quickHull(d,e,a,c);c.sortPolygon();return c};b._quickHull=function(a,c,d,e){if(d.length){var k=h.Helpers.findFarthestPointFromLineToTheLeft(a,c,d);e.addVertex(k);e.count(d.length);var g=h.Helpers.splitPointsByTriangle(a,c,k,d);e.count(d.length);b._quickHull(a,k,g[0],e);b._quickHull(k,c,g[1],e)}};
b.giftWrapping=function(a){var c=new h.Result,d=h.Helpers.findExtremes(a).max,e=d,b=[0,-1];do{c.count();c.addVertex(e);for(var g=null,f=null,l=null,n=0,r=a.length;n<r;n++)if(a[n]!==e){c.count();var p=[a[n].getX()-e.getX(),a[n].getY()-e.getY()],q=h.Helpers.vectorsAngle(b,p);if(null===g||q<g)g=q,f=p,l=a[n]}b=f;e=l}while(e!==d);return c};b.primitive=function(a){for(var c=new h.Result,d=a.length,b=0;b<d;b++){for(var f=!0,g=0;f&&g<d;g++)if(b!==g)for(var m=0;f&&m<d;m++)if(b!==m&&g!==m)for(var l=0;f&&l<
d;l++)b!==l&&g!==l&&m!==l&&(c.count(),h.Helpers.laysPointInTriangle(a[b],a[g],a[m],a[l])&&(f=!1));f&&c.addVertex(a[b])}c.sortPolygon();return c};return b}();h.Solver=f})(ConvexHull||(ConvexHull={}));
(function(h){var f=function(){function b(a,c,d,b,f,g,h){this.pointCountSlider=a;this.pointCountInfo=c;this.generatorButton=d;this.quickHullButton=b;this.giftWrappingButton=f;this.primitiveButton=g;this.clearButton=h}b.prototype.getPointCountSlider=function(){return this.pointCountSlider};b.prototype.getPointCountInfo=function(){return this.pointCountInfo};b.prototype.getPointCount=function(){return parseInt(this.pointCountSlider.val())};b.prototype.getGeneratorButton=function(){return this.generatorButton};
b.prototype.getQuickHullButton=function(){return this.quickHullButton};b.prototype.getGiftWrappingButton=function(){return this.giftWrappingButton};b.prototype.getPrimitiveButton=function(){return this.primitiveButton};b.prototype.getClearButton=function(){return this.clearButton};return b}();h.Controls=f})(ConvexHull||(ConvexHull={}));
(function(h){var f=function(){function b(a,c){this.points=[];this.canvas=a;this.controls=c}b.prototype.run=function(){var a=this,c=function(){a.controls.getPointCountInfo().text(a.controls.getPointCount())};c();this.controls.getPointCountSlider().on("input change",function(a){c()});this.processAlgButtons(function(c){c.on("click",function(c){a.setAlgButtonsDisabled(!0)})});this.controls.getGeneratorButton().on("click",function(c){a.generatePoints(a.controls.getPointCount());a.canvas.drawPoints(a.points);
a.setAlgButtonsDisabled(!1)});this.controls.getQuickHullButton().on("click",function(c){a.runAlgorithm(h.Solver.quickHull,"quick hull")});this.controls.getGiftWrappingButton().on("click",function(c){a.runAlgorithm(h.Solver.giftWrapping,"gift wrapping")});this.controls.getPrimitiveButton().on("click",function(c){a.runAlgorithm(h.Solver.primitive,"primitive")});this.controls.getClearButton().on("click",function(c){a.canvas.clearSolution();a.setAlgButtonsDisabled(!1)})};b.prototype.generatePoints=function(a){for(this.points=
[];this.points.length<a;){for(var c=!1,b=this.canvas.getPadding()+Math.floor((this.canvas.getWidth()-2*this.canvas.getPadding())*Math.random()),e=this.canvas.getPadding()+Math.floor((this.canvas.getHeight()-2*this.canvas.getPadding())*Math.random()),f=0,g=this.points.length;f<g;f++)if(this.points[f].getX()===b||this.points[f].getY()===e){c=!0;break}c||this.points.push(new h.Point(b,e,f))}};b.prototype.runAlgorithm=function(a,c){var b=(new Date).getTime(),e=a(this.points),b=(new Date).getTime()-b;
this.canvas.drawPolygon(e.getPolygon(),"#44f","#99f");this.canvas.operationCountInfo(e.getCounter(),b,c)};b.prototype.setAlgButtonsDisabled=function(a){void 0===a&&(a=!0);this.processAlgButtons(function(c){c.attr("disabled",a?!0:null)});this.controls.getClearButton().attr("disabled",a?null:!0)};b.prototype.processAlgButtons=function(a){for(var c=[this.controls.getQuickHullButton(),this.controls.getGiftWrappingButton(),this.controls.getPrimitiveButton()],b=0,e=c.length;b<e;b++)a(c[b])};return b}();
h.Program=f})(ConvexHull||(ConvexHull={}));(function(h,f){var b=new ConvexHull.Canvas(f("#canvas"),50),a=new ConvexHull.Controls(f("#point-count"),f("#point-count-info"),f("#generate"),f("#alg-quick-hull"),f("#alg-gift-wrapping"),f("#alg-primitive"),f("#clear"));(new ConvexHull.Program(b,a)).run()})(window,window.jQuery);
